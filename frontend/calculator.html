<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awesome Calculator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font for a clean, modern look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrollbars from appearing due to canvas animation */
        }
        /* Position the canvas to cover the entire background */
        #interactive-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        /* The main content container needs to be on top of the canvas */
        .calculator {
            position: relative;
            z-index: 1;
            max-width: 400px;
        }
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .hidden {
            display: none;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 1s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-950 flex justify-center items-center h-screen p-4">
    <!-- The canvas for the interactive particle background -->
    <canvas id="interactive-canvas"></canvas>

    <!-- The original calculator content -->
    <div class="calculator bg-white bg-opacity-20 backdrop-filter backdrop-blur-md p-6 rounded-3xl shadow-2xl border border-white border-opacity-30 max-w-sm w-full animate-fade-in">
        <input type="text" id="calculator-display" class="calculator-display bg-white bg-opacity-10 text-white text-5xl text-right py-4 px-4 rounded-xl mb-4 w-full border border-white border-opacity-30 focus:outline-none" disabled>
        <div class="calculator-buttons">
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="AC">AC</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="neg">+/-</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="%">%</button>
            <button class="operator bg-purple-500 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="/">&divide;</button>
            
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="7">7</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="8">8</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="9">9</button>
            <button class="operator bg-purple-500 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="*">&times;</button>
            
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="4">4</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="5">5</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="6">6</button>
            <button class="operator bg-purple-500 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="-">-</button>
            
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="1">1</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="2">2</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="3">3</button>
            <button class="operator bg-purple-500 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="+">+</button>
            
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105 col-span-2" data-value="0">0</button>
            <button class="bg-white bg-opacity-10 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value=".">.</button>
            <button class="equals bg-purple-500 text-white text-2xl font-bold py-4 rounded-xl transition-all duration-200 transform hover:scale-105" data-value="=">=</button>
        </div>
    </div>
    
    <script>
        // --- ANIMATED BACKGROUND CANVAS LOGIC ---
        const canvas = document.getElementById('interactive-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let mouse = { x: null, y: null, radius: 100 };
        // Array of mathematical symbols to use in the background
        const mathSymbols = ['+', '-', '×', '÷', '=', '√', '∫', '∑', 'π', '∞'];
    
        function resizeCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    
        window.addEventListener('mousemove', (event) => {
            mouse.x = event.x;
            mouse.y = event.y;
        });
    
        class Particle {
            constructor(x, y) {
                this.x = x || Math.random() * width;
                this.y = y || Math.random() * height;
                this.size = Math.random() * 100 + 8; // Larger text size
                this.speedX = Math.random() * 1 - 0.5; // Faster horizontal speed
                this.speedY = Math.random() * 1 - 0.5; // Faster vertical speed
                this.symbol = mathSymbols[Math.floor(Math.random() * mathSymbols.length)];
                this.opacity = Math.random();
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.font = `${this.size}px Inter`; // Use the Inter font
                ctx.fillText(this.symbol, this.x, this.y);
            }
            update() {
                if (this.x + this.size > width || this.x - this.size < 0) {
                    this.speedX = -this.speedX;
                }
                if (this.y + this.size > height || this.y - this.size < 0) {
                    this.speedY = -this.speedY;
                }
                this.x += this.speedX;
                this.y += this.speedY;
                if (mouse.x !== null) {
                    let dx = mouse.x - this.x;
                    let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < mouse.radius) {
                        const angle = Math.atan2(dy, dx);
                        const force = mouse.radius / distance;
                        this.x -= Math.cos(angle) * force * 0.5;
                        this.y -= Math.sin(angle) * force * 0.5;
                    }
                }
            }
        }
    
        function init() {
            particles = [];
            let numberOfParticles = (width * height) / 10000;
            for (let i = 0; i < numberOfParticles; i++) {
                particles.push(new Particle());
            }
        }
    
        // The main animation loop
        function animate() {
            requestAnimationFrame(animate);
            ctx.clearRect(0, 0, width, height);
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
            }
        }
    
        // --- CALCULATOR LOGIC (INTEGRATED FROM script.js) ---
        const display = document.getElementById('calculator-display');
        const buttons = document.querySelector('.calculator-buttons');
    
        let firstValue = null;
        let operator = null;
        let waitingForSecondValue = false;
        let currentInput = '';
    
        function updateDisplay(value) {
            display.value = value;
        }
    
        buttons.addEventListener('click', (event) => {
            const { target } = event;
            if (!target.matches('button')) return;
            const value = target.dataset.value;
    
            if (value === 'AC') {
                firstValue = null; operator = null; waitingForSecondValue = false;
                currentInput = ''; updateDisplay('');
                return;
            }
            if (target.classList.contains('operator')) {
                if (firstValue === null) firstValue = parseFloat(currentInput);
                operator = value; waitingForSecondValue = true; currentInput = '';
                return;
            }
            if (value === '=') {
                if (firstValue !== null && operator !== null && currentInput !== '') {
                    calculateAndDisplay();
                }
                return;
            }
            if (value === '.' && currentInput.includes('.')) return;
            
            currentInput += value;
            updateDisplay(currentInput);
        });
    
        async function calculateAndDisplay() {
            if (firstValue === null || operator === null || currentInput === '') return;
            const num1 = firstValue;
            const num2 = parseFloat(currentInput);
            const payload = { num1, num2, operator };
    
            try {
                const response = await fetch('http://localhost:3000/calculate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                updateDisplay(data.result);
                firstValue = data.result; operator = null; waitingForSecondValue = false;
                currentInput = data.result.toString();
            } catch (error) {
                console.error('Error during calculation:', error);
                updateDisplay('Error');
                firstValue = null; operator = null; waitingForSecondValue = false;
                currentInput = '';
            }
        }
    
        // Initialize and start the animation loop when the window loads
        window.onload = function() {
            init();
            animate();
        };
    </script>
</body>
</html>
